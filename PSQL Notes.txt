PS SQL Notes:

# Connecting to the database
psql -h <hostname> -p <port> -U <username> -d <database>

# Check Current Env i am in
\conninfo

# Check Current Database
SELECT current_database();

# Create A User
CREATE USER myuser WITH PASSWORD 'mypassword';

# Check all Users
\du

# To quit any view
\q

# Clear command line
\! clear

# Lists all relations (tables, views, sequences) in the current database.
\d

# Check if auto commit is on
\echo :AUTOCOMMIT

# to change auto commit to 'ON' or 'OFF'
\set AUTOCOMMIT on    -- turn on
\set AUTOCOMMIT off   -- turn off


# Creating Tables and Indexes Sample and constraint to friegn keys
CREATE TABLE t_order (
    order_id BIGSERIAL PRIMARY KEY,
    order_number VARCHAR(30) NOT NULL,
    status VARCHAR(10) NOT NULL,
	warehouse VARCHAR(30) NOT NULL,
    warehouse_code VARCHAR(5) NOT NULL,
	warehouse_address VARCHAR(100) NOT NULL,
	customer_name  VARCHAR(100) NOT NULL,
	customer_address  VARCHAR(100) NOT NULL,
    record_create_id VARCHAR(30) NOT NULL,
    record_create_date TIMESTAMP NOT NULL,
    record_update_id VARCHAR(30),
    record_update_date TIMESTAMP
);
-- indexes for better performance
CREATE INDEX idx_order_order_number ON t_order(order_number);
CREATE INDEX idx_order_status ON t_order(status);


-- CREATE Trailer Table
CREATE TABLE t_trailer(
    trailer_id BIGSERIAL PRIMARY KEY,
    trailer_number VARCHAR(30),
    lm_id BIGINT NOT NULL,
    record_create_id VARCHAR(30) NOT NULL,
    record_create_date TIMESTAMP NOT NULL,
    record_update_id VARCHAR(30),
    record_update_date TIMESTAMP,
    CONSTRAINT fk_trailer_load_master
        FOREIGN KEY(lm_id) REFERENCES t_load_master(lm_id)
);

CREATE INDEX idx_trailer_lm_id ON t_trailer(lm_id);

# Grant Privilage For A User on A Table
GRANT SELECT ON TABLE t_yard_location TO qulronwebapp;
GRANT ALL PRIVILEGES ON TABLE t_driver_location TO qulronwebapp;

# Grant Privilage on A Sequence (BIGSERIAL Primary Key) for User
# Grants for sequences (auto-generated by BIGSERIAL)
GRANT USAGE, SELECT ON SEQUENCE t_open_load_ol_id_seq TO qulronwebapp;


# Check if AutoVacume is ON
SHOW autovacuum;

# These control how many row changes trigger ANALYZE or VACUUM. (For Indexing)
SHOW autovacuum_analyze_scale_factor;
SHOW autovacuum_vacuum_scale_factor;

autovacuum_analyze_scale_factor = 0.1 means PostgreSQL will trigger an ANALYZE on a table when ~10% of its rows
autovacuum_vacuum_scale_factor = 0.2 means A VACUUM will run when ~20% of the rows have changed.

